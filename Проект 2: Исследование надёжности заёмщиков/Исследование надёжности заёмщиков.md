<a name="шаг0"></a>
# Оглавление

[**Шаг 1. Общая информация**](#шаг1)

[**Шаг 2. Предобработка данных**](#шаг2)

[*2.1. Обработка пропусков*](#шаг2-1)

[*2.2._Замена типа данных*](#шаг2-2)

[*2.3._Обработка дубликатов*](#шаг2-3)

[*2.4._Лемматизация*](#шаг2-4)

[*2.5._Категоризация данных*](#шаг2-5)

[**Шаг 3. Ответы на вопросы**](#шаг3)

[*3.1._Есть ли зависимость между наличием детей и возвратом кредита в срок?*](#шаг3-1)

[*3.2._Есть ли зависимость между семейным положением и возвратом кредита в срок?*](#шаг3-2)

[*3.3._Есть ли зависимость между уровнем дохода и возвратом кредита в срок?*](#шаг3-3)

[*3.4._Как разные цели кредита влияют на его возврат в срок?*](#шаг3-4)

[**Шаг 4. Общий вывод**](#шаг4)



# Исследование надёжности заёмщиков - постановка задачи

Заказчик — кредитный отдел банка. Нужно разобраться, влияет ли семейное положение и количество детей клиента на факт погашения кредита в срок. Входные данные от банка — статистика о платёжеспособности клиентов.

Результаты исследования будут учтены при построении модели **кредитного скоринга** — специальной системы, которая оценивает способность потенциального заёмщика вернуть кредит банку.

[к Оглавлению](#шаг0)

<a name="шаг1"></a>
# Шаг 1. Общая информация


```python
import pandas as pd
data=pd.read_csv('/datasets/data.csv')
data.head(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>children</th>
      <th>days_employed</th>
      <th>dob_years</th>
      <th>education</th>
      <th>education_id</th>
      <th>family_status</th>
      <th>family_status_id</th>
      <th>gender</th>
      <th>income_type</th>
      <th>debt</th>
      <th>total_income</th>
      <th>purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>-8437.673028</td>
      <td>42</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>253875.639453</td>
      <td>покупка жилья</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>-4024.803754</td>
      <td>36</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>112080.014102</td>
      <td>приобретение автомобиля</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0</td>
      <td>-5623.422610</td>
      <td>33</td>
      <td>Среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>145885.952297</td>
      <td>покупка жилья</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>-4124.747207</td>
      <td>32</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>267628.550329</td>
      <td>дополнительное образование</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0</td>
      <td>340266.072047</td>
      <td>53</td>
      <td>среднее</td>
      <td>1</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>пенсионер</td>
      <td>0</td>
      <td>158616.077870</td>
      <td>сыграть свадьбу</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0</td>
      <td>-926.185831</td>
      <td>27</td>
      <td>высшее</td>
      <td>0</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>M</td>
      <td>компаньон</td>
      <td>0</td>
      <td>255763.565419</td>
      <td>покупка жилья</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0</td>
      <td>-2879.202052</td>
      <td>43</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>компаньон</td>
      <td>0</td>
      <td>240525.971920</td>
      <td>операции с жильем</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0</td>
      <td>-152.779569</td>
      <td>50</td>
      <td>СРЕДНЕЕ</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>135823.934197</td>
      <td>образование</td>
    </tr>
    <tr>
      <td>8</td>
      <td>2</td>
      <td>-6929.865299</td>
      <td>35</td>
      <td>ВЫСШЕЕ</td>
      <td>0</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>95856.832424</td>
      <td>на проведение свадьбы</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0</td>
      <td>-2188.756445</td>
      <td>41</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>144425.938277</td>
      <td>покупка жилья для семьи</td>
    </tr>
  </tbody>
</table>
</div>



Банк предоставил статистику платёжеспособности клиентов, содержащую следующую информацию:
- `children` — количество детей в семье
- `days_employed` — общий трудовой стаж в днях
- `dob_years` — возраст клиента в годах
- `education` — уровень образования клиента
- `education_id` — идентификатор уровня образования
- `family_status` — семейное положение
- `family_status_id` — идентификатор семейного положения
- `gender` — пол клиента
- `income_type` — тип занятости
- `debt` — имел ли задолженность по возврату кредитов
- `total_income` — ежемесячный доход
- `purpose` — цель получения кредита.

Структура файла изучена, обращаем внимание на следующее:  
- общий трудовой стаж в днях: встречается с отрицательными значениями;  
- уровень образования клиента: слова могут различаться лишь разными регистрами букв;  
- цель получения кредита: одинаковая цель представлена разными словами (типа "образование"="доп.образование" и т.д.).

[к Оглавлению](#шаг0)

<a name="шаг2"></a>
# Шаг 2. Предобработка данных

<a name="шаг2-1"></a>
## 2.1. Обработка пропусков


```python
data.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 21525 entries, 0 to 21524
    Data columns (total 12 columns):
    children            21525 non-null int64
    days_employed       19351 non-null float64
    dob_years           21525 non-null int64
    education           21525 non-null object
    education_id        21525 non-null int64
    family_status       21525 non-null object
    family_status_id    21525 non-null int64
    gender              21525 non-null object
    income_type         21525 non-null object
    debt                21525 non-null int64
    total_income        19351 non-null float64
    purpose             21525 non-null object
    dtypes: float64(2), int64(5), object(5)
    memory usage: 2.0+ MB


**Вывод**

Оценен объём данных в таблице data: 12 колонок и 21 525 записей.<br/>
    Сразу видно, что в двух колонках (days_employed и total_income) отсутствует одинаковое количество значений.

Целесообразно заменить пропущенные значения на средние значения трудового стажа и дохода в группе, ориентируяcь на уровень дохода, например. Выясним, в какие группы попали пропущенные значения стажа и дохода:


```python
display(data[data['days_employed'].isnull() == True]['income_type'].value_counts())
display(data[data['total_income'].isnull() == True]['income_type'].value_counts())
```


    сотрудник          1105
    компаньон           508
    пенсионер           413
    госслужащий         147
    предприниматель       1
    Name: income_type, dtype: int64



    сотрудник          1105
    компаньон           508
    пенсионер           413
    госслужащий         147
    предприниматель       1
    Name: income_type, dtype: int64


Нулевые значения попали в одинаковые группы (это логично: нет стажа => нет дохода): сотрудники, компаньоны, пенсионеры, госслужащие и предприниматель. Рассчитаем средний  доход для каждой группы дохода без учёта нулевых значений и хаменим на это значение все нулевые значения. Применим цикл:


```python
income_type_list=['сотрудник', 'компаньон', 'пенсионер', 'госслужащий', 'предприниматель']

for i in income_type_list:
    data.loc[(data['total_income'].isnull() == True)&(data['income_type']==i),'total_income']=data[(data.income_type == i)&(data.total_income!= 0)]['total_income'].mean()
    print(i, 'средний доход  %.0f' % (data[data.income_type == i]['total_income'].mean()))
   
display(data[data['total_income'].isnull() == True]['income_type'].value_counts())
```

    сотрудник средний доход  161380
    компаньон средний доход  202417
    пенсионер средний доход  137127
    госслужащий средний доход  170898
    предприниматель средний доход  499163



    Series([], Name: income_type, dtype: int64)


Проверка показала, что нулевых значений не осталось в столбце дохода. 

Повторим тот же цикл для столбца стажа, но вначале откорректируем его, т.к. в нем встретилось много отрицательных значений. Исправим это методом abs() и проверим результат:


```python
data['days_employed'] = data['days_employed'].abs()

for i in income_type_list:
    data.loc[(data['days_employed'].isnull() == True)&(data['income_type']==i),'days_employed']=data[(data.income_type == i)&(data.days_employed!= 0)]['days_employed'].mean()
    print(i, 'средний стаж %.0f' % (data[data.income_type == i]['days_employed'].mean()))
   
display(data[data['days_employed'].isnull() == True]['income_type'].value_counts())
```

    сотрудник средний стаж 2326
    компаньон средний стаж 2112
    пенсионер средний стаж 365003
    госслужащий средний стаж 3400
    предприниматель средний стаж 521



    Series([], Name: income_type, dtype: int64)


Эта проверка показывает, что пропусков в таблице теперь нет.<br/>
    Следующий шаг - нужно проанализировать содержимое таблицы на наличие пропусков NaN и None, а также на наличие прочих некорректных значений. Для этого применим метод unique() и определим, какие уникальные значения есть в каждом столбце таблицы data:


```python
for col in data:
    print(col, data[col].unique())
```

    children [ 1  0  3  2 -1  4 20  5]
    days_employed [8437.67302776 4024.80375385 5623.42261023 ... 2113.3468877  3112.4817052
     1984.50758853]
    dob_years [42 36 33 32 53 27 43 50 35 41 40 65 54 56 26 48 24 21 57 67 28 63 62 47
     34 68 25 31 30 20 49 37 45 61 64 44 52 46 23 38 39 51  0 59 29 60 55 58
     71 22 73 66 69 19 72 70 74 75]
    education ['высшее' 'среднее' 'Среднее' 'СРЕДНЕЕ' 'ВЫСШЕЕ' 'неоконченное высшее'
     'начальное' 'Высшее' 'НЕОКОНЧЕННОЕ ВЫСШЕЕ' 'Неоконченное высшее'
     'НАЧАЛЬНОЕ' 'Начальное' 'Ученая степень' 'УЧЕНАЯ СТЕПЕНЬ'
     'ученая степень']
    education_id [0 1 2 3 4]
    family_status ['женат / замужем' 'гражданский брак' 'вдовец / вдова' 'в разводе'
     'Не женат / не замужем']
    family_status_id [0 1 2 3 4]
    gender ['F' 'M' 'XNA']
    income_type ['сотрудник' 'пенсионер' 'компаньон' 'госслужащий' 'безработный'
     'предприниматель' 'студент' 'в декрете']
    debt [0 1]
    total_income [253875.6394526  112080.01410244 145885.95229686 ...  89672.56115303
     244093.05050043  82047.41889948]
    purpose ['покупка жилья' 'приобретение автомобиля' 'дополнительное образование'
     'сыграть свадьбу' 'операции с жильем' 'образование'
     'на проведение свадьбы' 'покупка жилья для семьи' 'покупка недвижимости'
     'покупка коммерческой недвижимости' 'покупка жилой недвижимости'
     'строительство собственной недвижимости' 'недвижимость'
     'строительство недвижимости' 'на покупку подержанного автомобиля'
     'на покупку своего автомобиля' 'операции с коммерческой недвижимостью'
     'строительство жилой недвижимости' 'жилье'
     'операции со своей недвижимостью' 'автомобили' 'заняться образованием'
     'сделка с подержанным автомобилем' 'получение образования' 'автомобиль'
     'свадьба' 'получение дополнительного образования' 'покупка своего жилья'
     'операции с недвижимостью' 'получение высшего образования'
     'свой автомобиль' 'сделка с автомобилем' 'профильное образование'
     'высшее образование' 'покупка жилья для сдачи' 'на покупку автомобиля'
     'ремонт жилью' 'заняться высшим образованием']


Изучим значения столбца CHILDREN:<br/>
- встретилось отрицательное число детей (-1) - заменим его на положительное значение методом loc<br/>
- настораживает подозрительное значение числа детей 20 - скорее всего по ошибке после цифры 2 был добавлен 0. Изменим данное число на 2 также методом loc.<br/>
Вероятно, данные ошибки связаны с человеческим фактором (некоректный ввод числа). Метод groupby поможет оценить объём некорректных значений количества детей есть в таблице:


```python
data.groupby('children')['debt'].count() 
```




    children
    -1        47
     0     14149
     1      4818
     2      2055
     3       330
     4        41
     5         9
     20       76
    Name: debt, dtype: int64



Получилась следующая картина: 47 строк со значением -1 детей и 76 строк со значением 20 детей. Применим метод loc и посморим на результат:


```python
data.loc[data['children'] == -1,'children'] = 1
data.loc[data['children'] == 20,'children'] = 2
data.groupby('children')['debt'].count()
```




    children
    0    14149
    1     4865
    2     2131
    3      330
    4       41
    5        9
    Name: debt, dtype: int64



Убедились, что некорректные значения в столбце CHILDREN исправлены.

Изучим теперь значения столбца DOB_YEARS - в данный столбец закралась явная ошибка - значение 0, т.к.заемщик не может иметь возраст 0 лет. Так как значение возраста не критично для текущего исследования (нам важно количество детей и семейное положение заемщика), то целесообразно заменить нулевые значения на средние значения возраста в группе по уровню дохода, например. Выясним, в какие группы попали нулевые значения возраста заемщиков:


```python
data[data.dob_years== 0].groupby('income_type')['dob_years'].count()
```




    income_type
    госслужащий     6
    компаньон      20
    пенсионер      20
    сотрудник      55
    Name: dob_years, dtype: int64



Нулевые значения попали в 4 группы: госслужащие, компаньоны, пенсионеры и сотрудники. Рассчитаем средний возраст для каждой группы дохода без учёта нулевых значений:


```python
gossluga_mean=data[(data.income_type == 'госслужащий')&(data.dob_years!= 0)]['dob_years'].mean()
kompanion_mean=data[(data.income_type == 'компаньон')&(data.dob_years!= 0)]['dob_years'].mean()
pension_mean=data[(data.income_type == 'пенсионер')&(data.dob_years!= 0)]['dob_years'].mean()
sotrudnik_mean=data[(data.income_type == 'сотрудник')&(data.dob_years!= 0)]['dob_years'].mean()

print('госслужащий: средний возраст %.0f' % (gossluga_mean))
print('компаньон: средний возраст %.0f' % (kompanion_mean))
print('пенсионер: средний возраст %.0f' % (pension_mean))
print('сотрудник: средний возраст %.0f' % (sotrudnik_mean))
```

    госслужащий: средний возраст 41
    компаньон: средний возраст 40
    пенсионер: средний возраст 59
    сотрудник: средний возраст 40


Заменим нулевые значения на средние значения в каждой группе:


```python
data.loc[(data.income_type == 'госслужащий')&(data.dob_years== 0),'dob_years']=gossluga_mean
data.loc[(data.income_type == 'компаньон')&(data.dob_years== 0),'dob_years']=kompanion_mean
data.loc[(data.income_type == 'пенсионер')&(data.dob_years== 0),'dob_years']=pension_mean
data.loc[(data.income_type == 'сотрудник')&(data.dob_years== 0),'dob_years']=sotrudnik_mean
```

Проверим, есть ли нулевые значения в столбце возраста заемщика:


```python
data[data.dob_years== 0].groupby('income_type')['dob_years'].count()
```




    Series([], Name: dob_years, dtype: int64)



Убедились, что нулевых значений не осталось в столбце возраста.<br/><br/>
Изучим столбец GENDER - одно значение в нем непонятное "XNA". Пол никак не влияет на результат нашего исследования, поэтому просто заменим его на слово "неизвестно" и проверим результат:


```python
data.loc[data['gender'] == 'XNA','gender'] = 'неизвестно'
data['gender'].unique()
```




    array(['F', 'M', 'неизвестно'], dtype=object)



Столбец gender исправлен.<br/><br/>
Изучим столбец TOTAL INCOME. На всякий случай проверим, нет ли в значениях отрицательных чисел:


```python
data[data.total_income<0].count()
```




    children            0
    days_employed       0
    dob_years           0
    education           0
    education_id        0
    family_status       0
    family_status_id    0
    gender              0
    income_type         0
    debt                0
    total_income        0
    purpose             0
    dtype: int64



Отрицательных чисел не встретилось в столбце дохода.<br/>

Также в целях единообразия стиля было бы нелишним немного откорректировать оформление в столбце FAMILY_STATUS - в стутусе  "Не женат / не замужем" заменить заглавную букву Н на строчную. Применим метод str() и посмотрим на результат:


```python
data['family_status'] = data['family_status'].str.lower()
data['family_status'].unique()
```




    array(['женат / замужем', 'гражданский брак', 'вдовец / вдова',
           'в разводе', 'не женат / не замужем'], dtype=object)



Заглавная буква в столбце family_status исправлена.

То же самое проделаем и со столбцом EDUCATION - применим метод str() и посмотрим на результат:


```python
data['education'] = data['education'].str.lower()
data['education'].unique()
```




    array(['высшее', 'среднее', 'неоконченное высшее', 'начальное',
           'ученая степень'], dtype=object)



Теперь количество вариантов значений в столбце education составляет 5, что соответствует количеству значений в столбце education_id.

**Вывод**

В результате детальной проверки данных в таблице были обнаружены пропуски и некорректные значения в следующих столбцах:___<br/>
- пропуски в столбцах days_employed и total_income заменены на значение 0 методом fillna();<br/>
- отрицательные значения (-1), а также явно некорректные значения (20) в столбце children исправлены методом loc;<br/>
- отрицательные значения в столбце days_employed исправлены методом abs();<br/>
- нулевые значения в столбце dob_years заменены на средние значения в каждой группе дохода с помощью методов groupby() и loc();<br/>
- непонятное значение "XNA" в столбце gender заменено на слово «неизвестно» методом loc();<br/>
- проверка столбца total_income на наличие отрицательных значений таковых не выявила;
- исправлены заглявные буквы в столбцах family_status и education_id.

<a name="шаг2-2"></a>
## 2.2. Замена типа данных

Получим информацию о типах данных в таблице:


```python
data.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 21525 entries, 0 to 21524
    Data columns (total 12 columns):
    children            21525 non-null int64
    days_employed       21525 non-null float64
    dob_years           21525 non-null float64
    education           21525 non-null object
    education_id        21525 non-null int64
    family_status       21525 non-null object
    family_status_id    21525 non-null int64
    gender              21525 non-null object
    income_type         21525 non-null object
    debt                21525 non-null int64
    total_income        21525 non-null float64
    purpose             21525 non-null object
    dtypes: float64(3), int64(4), object(5)
    memory usage: 2.0+ MB


Столбцы days_employed, dob_years и total_income имеют вещественный тип данных float. Заменим их на целочисленный тип, чтобы было удобно анализировать. Метод to_numeric() не подойдет, т.к.он переводит только в вещественные числа, поэтому используем метод astype() и проверим результат:


```python
#Создадим список столбцов, в которых нужно изменить тип данных
data1=['days_employed','dob_years','total_income']

for i in data1:
    data[i]=data[i].astype('int')

data.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 21525 entries, 0 to 21524
    Data columns (total 12 columns):
    children            21525 non-null int64
    days_employed       21525 non-null int64
    dob_years           21525 non-null int64
    education           21525 non-null object
    education_id        21525 non-null int64
    family_status       21525 non-null object
    family_status_id    21525 non-null int64
    gender              21525 non-null object
    income_type         21525 non-null object
    debt                21525 non-null int64
    total_income        21525 non-null int64
    purpose             21525 non-null object
    dtypes: int64(7), object(5)
    memory usage: 2.0+ MB


**Вывод**

Вещественные числа переведены в целочисленные значения методом astype().

<a name="шаг2-3"></a>
## 2.3. Обработка дубликатов

Посчитаем количество дубликатов в таблице методом duplicated() и sum():


```python
data.duplicated().sum()
```




    71



Количество строк-дубликатов составило 71. Вероятно, это результат выгрузки данных. Создадим новую таблицу data_new без дубликатов, применив для удаления повторяющихся записей метод drop_duplicates():


```python
data_new=data.drop_duplicates().reset_index() 
data_new.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 21454 entries, 0 to 21453
    Data columns (total 13 columns):
    index               21454 non-null int64
    children            21454 non-null int64
    days_employed       21454 non-null int64
    dob_years           21454 non-null int64
    education           21454 non-null object
    education_id        21454 non-null int64
    family_status       21454 non-null object
    family_status_id    21454 non-null int64
    gender              21454 non-null object
    income_type         21454 non-null object
    debt                21454 non-null int64
    total_income        21454 non-null int64
    purpose             21454 non-null object
    dtypes: int64(8), object(5)
    memory usage: 2.1+ MB


Количество записей в новой таблице составляет 21454 записей.

**Вывод**

Данные в исходной таблице были проверены на наличие дубликатов  методом duplicated(). Было обнаружено 54 дубликата.  Метод drop_duplicates позволил созать новую таблицу data_new уже без дубликатов.

<a name="шаг2-4"></a>
## 2.4. Лемматизация

Получим уникальные значения purpose:


```python
purpose=data['purpose'].unique()
purpose
```




    array(['покупка жилья', 'приобретение автомобиля',
           'дополнительное образование', 'сыграть свадьбу',
           'операции с жильем', 'образование', 'на проведение свадьбы',
           'покупка жилья для семьи', 'покупка недвижимости',
           'покупка коммерческой недвижимости', 'покупка жилой недвижимости',
           'строительство собственной недвижимости', 'недвижимость',
           'строительство недвижимости', 'на покупку подержанного автомобиля',
           'на покупку своего автомобиля',
           'операции с коммерческой недвижимостью',
           'строительство жилой недвижимости', 'жилье',
           'операции со своей недвижимостью', 'автомобили',
           'заняться образованием', 'сделка с подержанным автомобилем',
           'получение образования', 'автомобиль', 'свадьба',
           'получение дополнительного образования', 'покупка своего жилья',
           'операции с недвижимостью', 'получение высшего образования',
           'свой автомобиль', 'сделка с автомобилем',
           'профильное образование', 'высшее образование',
           'покупка жилья для сдачи', 'на покупку автомобиля', 'ремонт жилью',
           'заняться высшим образованием'], dtype=object)



Склеим уникальные значения в одну строку с помощью метода join():


```python
purpose_str =','.join(purpose)
purpose_str
```




    'покупка жилья,приобретение автомобиля,дополнительное образование,сыграть свадьбу,операции с жильем,образование,на проведение свадьбы,покупка жилья для семьи,покупка недвижимости,покупка коммерческой недвижимости,покупка жилой недвижимости,строительство собственной недвижимости,недвижимость,строительство недвижимости,на покупку подержанного автомобиля,на покупку своего автомобиля,операции с коммерческой недвижимостью,строительство жилой недвижимости,жилье,операции со своей недвижимостью,автомобили,заняться образованием,сделка с подержанным автомобилем,получение образования,автомобиль,свадьба,получение дополнительного образования,покупка своего жилья,операции с недвижимостью,получение высшего образования,свой автомобиль,сделка с автомобилем,профильное образование,высшее образование,покупка жилья для сдачи,на покупку автомобиля,ремонт жилью,заняться высшим образованием'



Посчитаем частоту появления слов при помощи метода Counter(): 


```python
# импортируем pymystem3:
from pymystem3 import Mystem
m=Mystem()
from collections import Counter

lemmas=m.lemmatize(purpose_str)
counter=Counter(lemmas)
counter
```




    Counter({'покупка': 10,
             ' ': 59,
             'жилье': 7,
             ',': 37,
             'приобретение': 1,
             'автомобиль': 9,
             'дополнительный': 2,
             'образование': 9,
             'сыграть': 1,
             'свадьба': 3,
             'операция': 4,
             'с': 5,
             'на': 4,
             'проведение': 1,
             'для': 2,
             'семья': 1,
             'недвижимость': 10,
             'коммерческий': 2,
             'жилой': 2,
             'строительство': 3,
             'собственный': 1,
             'подержать': 2,
             'свой': 4,
             'со': 1,
             'заниматься': 2,
             'сделка': 2,
             'получение': 3,
             'высокий': 3,
             'профильный': 1,
             'сдача': 1,
             'ремонт': 1,
             '\n': 1})



Наиболее часто встречаются следующие цели:
- операции с недвижимостью;
- образование;
- автомобиль.

Также встретилась такая цель как свадьба. 

Напишем функцию для apply, которая будет лематизировать последовательно каждую ячейку столбца purpose и проверять, какая из категорий обнаруживается в лемматизированном варианте: 


```python
def purpose_group(purpose):
    lemmas_row = m.lemmatize(purpose)
    if 'жилье' in lemmas_row or 'недвижимость' in lemmas_row:
        return 'операции с недвижимостью'
    if 'образование' in lemmas_row:
        return 'образование'
    if 'свадьба' in lemmas_row:
        return 'свадьба'
    if 'автомобиль' in lemmas_row:
        return 'автомобиль'
    return 'прочее'
        
data_new['purpose_group']= data_new['purpose'].apply(purpose_group)    
data_new.head(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>children</th>
      <th>days_employed</th>
      <th>dob_years</th>
      <th>education</th>
      <th>education_id</th>
      <th>family_status</th>
      <th>family_status_id</th>
      <th>gender</th>
      <th>income_type</th>
      <th>debt</th>
      <th>total_income</th>
      <th>purpose</th>
      <th>purpose_group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>8437</td>
      <td>42</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>253875</td>
      <td>покупка жилья</td>
      <td>операции с недвижимостью</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4024</td>
      <td>36</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>112080</td>
      <td>приобретение автомобиля</td>
      <td>автомобиль</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>5623</td>
      <td>33</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>145885</td>
      <td>покупка жилья</td>
      <td>операции с недвижимостью</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>4124</td>
      <td>32</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>267628</td>
      <td>дополнительное образование</td>
      <td>образование</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>340266</td>
      <td>53</td>
      <td>среднее</td>
      <td>1</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>пенсионер</td>
      <td>0</td>
      <td>158616</td>
      <td>сыграть свадьбу</td>
      <td>свадьба</td>
    </tr>
    <tr>
      <td>5</td>
      <td>5</td>
      <td>0</td>
      <td>926</td>
      <td>27</td>
      <td>высшее</td>
      <td>0</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>M</td>
      <td>компаньон</td>
      <td>0</td>
      <td>255763</td>
      <td>покупка жилья</td>
      <td>операции с недвижимостью</td>
    </tr>
    <tr>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>2879</td>
      <td>43</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>компаньон</td>
      <td>0</td>
      <td>240525</td>
      <td>операции с жильем</td>
      <td>операции с недвижимостью</td>
    </tr>
    <tr>
      <td>7</td>
      <td>7</td>
      <td>0</td>
      <td>152</td>
      <td>50</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>135823</td>
      <td>образование</td>
      <td>образование</td>
    </tr>
    <tr>
      <td>8</td>
      <td>8</td>
      <td>2</td>
      <td>6929</td>
      <td>35</td>
      <td>высшее</td>
      <td>0</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>95856</td>
      <td>на проведение свадьбы</td>
      <td>свадьба</td>
    </tr>
    <tr>
      <td>9</td>
      <td>9</td>
      <td>0</td>
      <td>2188</td>
      <td>41</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>144425</td>
      <td>покупка жилья для семьи</td>
      <td>операции с недвижимостью</td>
    </tr>
  </tbody>
</table>
</div>



Таким образом получилось объединить распределить разные цели на более крупные группы. Проверим, что было включно в группу 'прочее':


```python
data_new[data_new.purpose_group == 'прочее']['purpose'].unique()
```




    array([], dtype=object)



В группу 'прочее' не попало ни одно значение из  purpose.

**Вывод**

Выделены леммы в значениях столбца с целями получения кредита с помощью метода m.lemmatize(). Затем была проведена лемматизация целей кредита путем лемматизации каждой ячейки и поиска в ней популярных категорий из Counter.

<a name="шаг2-5"></a>
## 2.5. Категоризация данных

Задача, поставленная в данном исследовании, заключается в том, чтобы определить существование зависимости между возвратом кредита в срок и следующими показателями:
- наличием детей;
- семейным положением;
- уровнем дохода;
- целями кредита.

Данные про количество детей категоризованы изначально. 

Также не нужно дополнительно категоризовывать информацию и про семеный статус и образование, т.к. им уже были присвоены категории: 'family_status_id' и 'education_id'. Целесообразно просто проверить коректность распределения пар по ним: 


```python
display(data_new.groupby(['education', 'education_id'])['education_id'].count())
display(data_new.groupby(['family_status', 'family_status_id'])['family_status_id'].count())
```


    education            education_id
    высшее               0                5250
    начальное            3                 282
    неоконченное высшее  2                 744
    среднее              1               15172
    ученая степень       4                   6
    Name: education_id, dtype: int64



    family_status          family_status_id
    в разводе              3                    1195
    вдовец / вдова         2                     959
    гражданский брак       1                    4151
    женат / замужем        0                   12339
    не женат / не замужем  4                    2810
    Name: family_status_id, dtype: int64


Видим, что категории образования и семейного статуса распределены коректно. 

Теперь нужно категоризовать цели кредита. Ранее был выделен укрупненный лист целей, состоящий из четырех следующих значений:


```python
purpose_groups=data_new['purpose_group'].unique()
purpose_groups
```




    array(['операции с недвижимостью', 'автомобиль', 'образование', 'свадьба'],
          dtype=object)



Преобразуем этот лист целей в словарь:


```python
purpose_groups_id = {v:k for k,v in enumerate(purpose_groups)}
display(purpose_groups_id)
```


    {'операции с недвижимостью': 0,
     'автомобиль': 1,
     'образование': 2,
     'свадьба': 3}


Получен список целей в виде словаря {цель:номер типа}. На его основе создадим новый столбец 'purpose_groups_id' c категориями по целям получения кредита:


```python
#по умолчанию пусть все значения в новом столбце будут равны 4:
data_new['purpose_group_id'] = 4

for row in range(len(data_new)):
    for i in purpose_groups_id:
        if i in data_new.iloc[row,13]:
            data_new.iloc[row,14] = purpose_groups_id[i]
        
data_new.head(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>children</th>
      <th>days_employed</th>
      <th>dob_years</th>
      <th>education</th>
      <th>education_id</th>
      <th>family_status</th>
      <th>family_status_id</th>
      <th>gender</th>
      <th>income_type</th>
      <th>debt</th>
      <th>total_income</th>
      <th>purpose</th>
      <th>purpose_group</th>
      <th>purpose_group_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>8437</td>
      <td>42</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>253875</td>
      <td>покупка жилья</td>
      <td>операции с недвижимостью</td>
      <td>0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4024</td>
      <td>36</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>112080</td>
      <td>приобретение автомобиля</td>
      <td>автомобиль</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>5623</td>
      <td>33</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>145885</td>
      <td>покупка жилья</td>
      <td>операции с недвижимостью</td>
      <td>0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>4124</td>
      <td>32</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>267628</td>
      <td>дополнительное образование</td>
      <td>образование</td>
      <td>2</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>340266</td>
      <td>53</td>
      <td>среднее</td>
      <td>1</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>пенсионер</td>
      <td>0</td>
      <td>158616</td>
      <td>сыграть свадьбу</td>
      <td>свадьба</td>
      <td>3</td>
    </tr>
    <tr>
      <td>5</td>
      <td>5</td>
      <td>0</td>
      <td>926</td>
      <td>27</td>
      <td>высшее</td>
      <td>0</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>M</td>
      <td>компаньон</td>
      <td>0</td>
      <td>255763</td>
      <td>покупка жилья</td>
      <td>операции с недвижимостью</td>
      <td>0</td>
    </tr>
    <tr>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>2879</td>
      <td>43</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>компаньон</td>
      <td>0</td>
      <td>240525</td>
      <td>операции с жильем</td>
      <td>операции с недвижимостью</td>
      <td>0</td>
    </tr>
    <tr>
      <td>7</td>
      <td>7</td>
      <td>0</td>
      <td>152</td>
      <td>50</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>135823</td>
      <td>образование</td>
      <td>образование</td>
      <td>2</td>
    </tr>
    <tr>
      <td>8</td>
      <td>8</td>
      <td>2</td>
      <td>6929</td>
      <td>35</td>
      <td>высшее</td>
      <td>0</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>95856</td>
      <td>на проведение свадьбы</td>
      <td>свадьба</td>
      <td>3</td>
    </tr>
    <tr>
      <td>9</td>
      <td>9</td>
      <td>0</td>
      <td>2188</td>
      <td>41</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>144425</td>
      <td>покупка жилья для семьи</td>
      <td>операции с недвижимостью</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>



Проверим, не осталось ли "4" в новом столбце 'purpose_group_id':


```python
data_new[data_new['purpose_group_id'] == 4].count().sum()
```




    0



Теперь предстоит категоризировать данные об уровне дохода. Разделим данные, к примеру, на 4 группы одинакового размера с помощбю метода qcut() и посмотрим на значения дохода в кадой группе:


```python
data_new['quantile'] = pd.qcut(data_new['total_income'], q=4)
total_income_groups=data_new['quantile'].unique()
total_income_groups
```




    [(202417.0, 2265604.0], (107623.0, 151887.0], (151887.0, 202417.0], (20666.999, 107623.0]]
    Categories (4, interval[float64]): [(20666.999, 107623.0] < (107623.0, 151887.0] < (151887.0, 202417.0] < (202417.0, 2265604.0]]



Получили 4 одинаковые группы со следующими интервалами дохода:

- от 20,7 тыс руб до 107,6 тыс руб;
- от 107,7 тыс руб до 151,8 тыс руб;
- от 151,9 тыс руб до 202,4 тыс руб;
- от 202,4 тыс руб до 2 265,6 тыс руб.

Напишем функции по категоризации доходов и проверим, корректно ли она работает:


```python
def income_group(total_income):
    if total_income < 107623:
        return 'менее 108 тыс руб'
    if 107623 <= total_income < 151887:
        return 'от 108 тыс до 152 тыс руб'
    if 151887 <= total_income < 202417:
        return 'от 152 тыс до 202 тыс руб'
    return 'более 202 тыс руб'
         
data_new['income_group']= data_new['total_income'].apply(income_group)    
print(income_group(90000))
print(income_group(151000))
print(income_group(202000))
print(income_group(203000))

data_new.head(10)
```

    менее 108 тыс руб
    от 108 тыс до 152 тыс руб
    от 152 тыс до 202 тыс руб
    более 202 тыс руб





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>children</th>
      <th>days_employed</th>
      <th>dob_years</th>
      <th>education</th>
      <th>education_id</th>
      <th>family_status</th>
      <th>family_status_id</th>
      <th>gender</th>
      <th>income_type</th>
      <th>debt</th>
      <th>total_income</th>
      <th>purpose</th>
      <th>purpose_group</th>
      <th>purpose_group_id</th>
      <th>quantile</th>
      <th>income_group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>8437</td>
      <td>42</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>253875</td>
      <td>покупка жилья</td>
      <td>операции с недвижимостью</td>
      <td>0</td>
      <td>(202417.0, 2265604.0]</td>
      <td>более 202 тыс руб</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4024</td>
      <td>36</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>112080</td>
      <td>приобретение автомобиля</td>
      <td>автомобиль</td>
      <td>1</td>
      <td>(107623.0, 151887.0]</td>
      <td>от 108 тыс до 152 тыс руб</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>5623</td>
      <td>33</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>145885</td>
      <td>покупка жилья</td>
      <td>операции с недвижимостью</td>
      <td>0</td>
      <td>(107623.0, 151887.0]</td>
      <td>от 108 тыс до 152 тыс руб</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>4124</td>
      <td>32</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>267628</td>
      <td>дополнительное образование</td>
      <td>образование</td>
      <td>2</td>
      <td>(202417.0, 2265604.0]</td>
      <td>более 202 тыс руб</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>340266</td>
      <td>53</td>
      <td>среднее</td>
      <td>1</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>пенсионер</td>
      <td>0</td>
      <td>158616</td>
      <td>сыграть свадьбу</td>
      <td>свадьба</td>
      <td>3</td>
      <td>(151887.0, 202417.0]</td>
      <td>от 152 тыс до 202 тыс руб</td>
    </tr>
    <tr>
      <td>5</td>
      <td>5</td>
      <td>0</td>
      <td>926</td>
      <td>27</td>
      <td>высшее</td>
      <td>0</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>M</td>
      <td>компаньон</td>
      <td>0</td>
      <td>255763</td>
      <td>покупка жилья</td>
      <td>операции с недвижимостью</td>
      <td>0</td>
      <td>(202417.0, 2265604.0]</td>
      <td>более 202 тыс руб</td>
    </tr>
    <tr>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>2879</td>
      <td>43</td>
      <td>высшее</td>
      <td>0</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>F</td>
      <td>компаньон</td>
      <td>0</td>
      <td>240525</td>
      <td>операции с жильем</td>
      <td>операции с недвижимостью</td>
      <td>0</td>
      <td>(202417.0, 2265604.0]</td>
      <td>более 202 тыс руб</td>
    </tr>
    <tr>
      <td>7</td>
      <td>7</td>
      <td>0</td>
      <td>152</td>
      <td>50</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>135823</td>
      <td>образование</td>
      <td>образование</td>
      <td>2</td>
      <td>(107623.0, 151887.0]</td>
      <td>от 108 тыс до 152 тыс руб</td>
    </tr>
    <tr>
      <td>8</td>
      <td>8</td>
      <td>2</td>
      <td>6929</td>
      <td>35</td>
      <td>высшее</td>
      <td>0</td>
      <td>гражданский брак</td>
      <td>1</td>
      <td>F</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>95856</td>
      <td>на проведение свадьбы</td>
      <td>свадьба</td>
      <td>3</td>
      <td>(20666.999, 107623.0]</td>
      <td>менее 108 тыс руб</td>
    </tr>
    <tr>
      <td>9</td>
      <td>9</td>
      <td>0</td>
      <td>2188</td>
      <td>41</td>
      <td>среднее</td>
      <td>1</td>
      <td>женат / замужем</td>
      <td>0</td>
      <td>M</td>
      <td>сотрудник</td>
      <td>0</td>
      <td>144425</td>
      <td>покупка жилья для семьи</td>
      <td>операции с недвижимостью</td>
      <td>0</td>
      <td>(107623.0, 151887.0]</td>
      <td>от 108 тыс до 152 тыс руб</td>
    </tr>
  </tbody>
</table>
</div>



Функция работает корректно.

**Вывод**

Проведена целей получения кредита с помощью словаря.

Проведена категоризация доходов с помощью метода qcut().

Проведена корректность распределения уровня образования и семейного статуса по их id.

Необходимая категоризация выполнена. Переходим к анализу данных.

[к Оглавлению](#шаг0)

<a name="шаг3"></a>
# Шаг 3. Ответы на вопросы

<a name="шаг3-1"></a>
## 3.1. Есть ли зависимость между наличием детей и возвратом кредита в срок?

Выведем инфрмацию по количеству детей среди заемщиков:


```python
data_new.groupby('children')['debt'].agg(['sum','count','mean']).sort_values(by='mean')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sum</th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>children</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>5</td>
      <td>0</td>
      <td>9</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <td>0</td>
      <td>1063</td>
      <td>14091</td>
      <td>0.075438</td>
    </tr>
    <tr>
      <td>3</td>
      <td>27</td>
      <td>330</td>
      <td>0.081818</td>
    </tr>
    <tr>
      <td>1</td>
      <td>445</td>
      <td>4855</td>
      <td>0.091658</td>
    </tr>
    <tr>
      <td>2</td>
      <td>202</td>
      <td>2128</td>
      <td>0.094925</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>41</td>
      <td>0.097561</td>
    </tr>
  </tbody>
</table>
</div>



**Вывод**

В целом наличие детей отрицательно влияет на показатель возврата кредита в срок, причем наблюдается зависимость - чем больше детей, тем чаще нарушают сроки:
- среди бездетных заемщиков всего 7,5% должников;
- среди тех, у кого 1 ребенок должников уже больше - 9,2%;
- те, кто имеет 2 детей, нарушают сроки в 9,5% случаев.

Встречаются некоторые исключения, но они редки.

<a name="шаг3-2"></a>
## 3.2. Есть ли зависимость между семейным положением и возвратом кредита в срок?

Выведем инфрмацию по семейному статусу среди заемщиков:


```python
data_new.groupby('family_status')['debt'].agg(['sum','count','mean']).sort_values(by='mean')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sum</th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>family_status</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>вдовец / вдова</td>
      <td>63</td>
      <td>959</td>
      <td>0.065693</td>
    </tr>
    <tr>
      <td>в разводе</td>
      <td>85</td>
      <td>1195</td>
      <td>0.071130</td>
    </tr>
    <tr>
      <td>женат / замужем</td>
      <td>931</td>
      <td>12339</td>
      <td>0.075452</td>
    </tr>
    <tr>
      <td>гражданский брак</td>
      <td>388</td>
      <td>4151</td>
      <td>0.093471</td>
    </tr>
    <tr>
      <td>не женат / не замужем</td>
      <td>274</td>
      <td>2810</td>
      <td>0.097509</td>
    </tr>
  </tbody>
</table>
</div>



**Вывод**

Видно, что клиенты банка, находящиеся в статусе "не женат/не замужем", хуже всех подходят к вопросу погашения кредита в срок - каждый 10й среди них должник.

А вот клиенты, находящиеся когда-либо в официальных отношениях в целом ответственнее подходят к вопросу погашения кредита в срок:
- среди женатых/замужних 7,5% должников
- среди тех, кто находится в гражданском браке больше - 9,3% должников.

Самые дисциплинированные заемщики встречаются среди тех, кто овдовел или развелся.

<a name="шаг3-3"></a>
## 3.3. Есть ли зависимость между уровнем дохода и возвратом кредита в срок?

Выведем инфрмацию по уровню дохода среди заемщиков:


```python
data_new.groupby('income_group')['debt'].agg(['sum','count','mean']).sort_values(by='mean')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sum</th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>income_group</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>более 202 тыс руб</td>
      <td>375</td>
      <td>5410</td>
      <td>0.069316</td>
    </tr>
    <tr>
      <td>менее 108 тыс руб</td>
      <td>427</td>
      <td>5364</td>
      <td>0.079605</td>
    </tr>
    <tr>
      <td>от 152 тыс до 202 тыс руб</td>
      <td>464</td>
      <td>5317</td>
      <td>0.087267</td>
    </tr>
    <tr>
      <td>от 108 тыс до 152 тыс руб</td>
      <td>475</td>
      <td>5363</td>
      <td>0.088570</td>
    </tr>
  </tbody>
</table>
</div>



**Вывод**

Видно, что клиенты банка с совокупным доходом более 202 тыс руб, а также наоборот с совокупным доходом менее 108 тыс руб более дисциплинировано подходят к вопросу погашения кредита. 

А вот доля должников среди заемщиков с доходом от 108 тыс до 202 тыс руб уже больше.

<a name="шаг3-4"></a>
## 3.4. Как разные цели кредита влияют на его возврат в срок?

Выведем инфрмацию по целям кредита среди заемщиков:


```python
pivot=data_new.pivot_table(index=['purpose_group'], values='debt', aggfunc='mean')
pivot.sort_values('debt', ascending=False)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>debt</th>
    </tr>
    <tr>
      <th>purpose_group</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>автомобиль</td>
      <td>0.093590</td>
    </tr>
    <tr>
      <td>образование</td>
      <td>0.092200</td>
    </tr>
    <tr>
      <td>свадьба</td>
      <td>0.080034</td>
    </tr>
    <tr>
      <td>операции с недвижимостью</td>
      <td>0.072334</td>
    </tr>
  </tbody>
</table>
</div>



**Вывод**

Видно, что клиенты банка, взявшие деньги на операции с недвижимостью, менее всех склонны задерживать выплату по кредиту - среди них встречается всего 7,2% должников. Почти также дисциплинированно подходят к своевременному погашению кредитов и те, кто взял кредит на свадьбу.
С другой стороны, те, кому понадобились деньги для получения образования,  также на приобретение автомобиля чаще других зареживают в выплатой кредита.

[к Оглавлению](#шаг0)

<a name="шаг4"></a>
# Шаг 4. Общий вывод

Подводя итоги, можно смело утверждать, что и наличие детей, и семейный статус, а также цель получения кредита влияют на вероятность платежей по кредиту в срок также сильно, как и уровень дохода заемщика.

Ниже наиболее вероятный портрет ответственного заемщика:
- без детей;
- вдовец/разведен/женат;
- уровень дохода более 202 тыс руб;
- намерен приобрести недвижимость или сыграть свадьбу.

А вот наиболее вероятный портрет недисциплинированного заемщика:
- с детьми;
- в гражданском браке/не женат;
- уровень дохода от 108-202 тыс руб;
- намерен приобрести автомобиль или получить образование.

[к Оглавлению](#шаг0)
